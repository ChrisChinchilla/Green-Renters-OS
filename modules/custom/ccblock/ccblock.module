<?php

/**
 * Implements hook_block_info().
 */
function ccblock_block_info() {
    $blocks = array();
    $blocks['ccblock'] = array(
        'info' => t('Creative Commons Block'),
    );

    return $blocks;
}

/**
 * Implements hook_block_view().
 */
function ccblock_block_view($delta='') {
    $block = array();

    switch($delta) {
        case 'ccblock' :
            $block['content'] = ccblock_view();
            break;
    }

    return $block;
}

/**
 * Custom function to assemble renderable array for block content.
 * Returns a renderable array with the block content.
 * @return
 *   returns a renderable array of block content.
 */
function ccblock_view() {

    if (arg(0) == 'node' && is_numeric(arg(1))) {
        // Get the nid
        $nid = arg(1);

        // Load the node if you need to
        $node = node_load($nid);


    $block = array();
$nodeURL = url(drupal_get_path_alias('node/' . $node->nid), array(
    'absolute' => TRUE,
    'alias' => FALSE
));
    $html = "<a rel='license' href='http://creativecommons.org/licenses/by-sa/4.0/'><img alt='Creative Commons License' style='border-width:0' src='https://i.creativecommons.org/l/by-sa/4.0/88x31.png' /></a><br /><span xmlns:dct='http://purl.org/dc/terms/' href='http://purl.org/dc/dcmitype/Text' property='dct:title' rel='dct:type'><?php echo $node->title; ?></span> by <a xmlns:cc='http://creativecommons.org/ns#' href='http://greenrenters.org' property='cc:attributionName' rel='cc:attributionURL'>Green Renters</a> is licensed under a <a rel='license' href='http://creativecommons.org/licenses/by-sa/4.0/'>Creative Commons Attribution-ShareAlike 4.0 International License</a>.<br />Based on a work at <a xmlns:dct='http://purl.org/dc/terms/' href='" . $nodeURL . "' rel='dct:source'>" . $nodeURL . "</a>.<br />Permissions beyond the scope of this license may be available at <a xmlns:cc='http://creativecommons.org/ns#' href='http://greenrenters.org/terms' rel='cc:morePermissions'>http://greenrenters.org/terms</a>.";

    $block = array(
        'message' => array(
            '#type' => 'markup',
            '#markup' => $html,
            '#suffix' => '',
        ),
    );

    return $block;
    }
}